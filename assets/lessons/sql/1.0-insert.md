# Records

Managing records in with SQL.

## Add a new row/record

To add a new employee to the employees table we'd use `INSERT INTO`.

```sql
INSERT INTO employees
            (name,
             surname,
             hire_date)
VALUES      ("loi",
             "tran",
             Date('now'))
```

## Insert multiple rows/records

We can `INSERT INTO` multiple records relatively easily as well.

```sql
INSERT INTO employees
            (name,
             surname,
             hire_date,
             email)
VALUES      ('Charles',
             'Lee',
             Date('now'),
             "charles@seepdeep.com"),
            ('Michael',
             'Do',
             Date('now'),
             "michael@seepdeep.com"),
            --- continued...
```

## Update rows of a table

To update specific fields of a record we'd use `UPDATE`. We use `WHERE` to identify which record to update.

```sql
UPDATE employees
SET    title = "CEO",
       hire_date = Date('now'),
WHERE  employee_id = 1;
```

## Update part of a field using a wildcard

Using `LIKE` and `%` we can update fields(or part) of them as necessary.

```sql
UPDATE employees
SET    email = REPLACE(email, Substr(email, Instr(email, '@')), '@seepdeep.com')
WHERE  email LIKE '%@chinookcorp.com';
```

## Random birth dates

By using advanced functions such as `ABS()` & `RANDOM()` we can produce dynamic birth_dates for our employees.

```sql
UPDATE employees
SET    birth_date = Date(Strftime('%s', 'now') - ( Abs(Random()) %
                                                   ( 60 * 365 * 24 * 60
                                                            * 60 ) ),
                                        'unixepoch');
```

## Update employees who are younger than 21 years

Combining `UPDATE` with `WHERE` we can update values that meet our criteria. In this case employees who are younger than 21.

```sql
UPDATE employees
SET    birth_date = Date(Strftime('%s', 'now') - ( Abs(Random()) % (
                         ( 60 - 21 ) * 365 * 24 * 60 *
                                      60 ) ),
                                        'unixepoch')
WHERE  birth_date > Date('now', '-21 years');
```

## Update age field based on current birth_date

By nesting our functions we can update a field(column) using another field(column). In this case we're updating the _age_ field based on the _birth_date_ field.

```sql
UPDATE employees
SET    age = ( Strftime('%Y', 'now') - Strftime('%Y', birth_date) ) - (
                    Strftime('%m-%d', 'now') < Strftime('%m-%d', birth_date) );
```

## Update all employees IDs

Window functions are advanced but elegant. In this case we're updating all our employee ids to be sequential.

```sql
CREATE temp TABLE temp_employees AS
  SELECT employee_id,
         Row_number() over (ORDER BY employee_id) AS new_employee_id FROM
employees;

UPDATE employees
SET    employee_id = (SELECT new_employee_id
                      FROM   temp_employees
                      WHERE  temp_employees.employee_id = employees.employee_id);

DROP TABLE temp_employees;
```
